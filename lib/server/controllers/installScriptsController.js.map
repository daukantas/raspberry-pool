{"version":3,"sources":["server/controllers/installScriptsController.js"],"names":[],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA,MAAM,oBAAoB,CAAC,GAAE,SAAH,EAAa,0BAAb,CAApB;AACN,MAAM,OAAO,IAAI,IAAJ,EAAP;AACN,MAAM,qBAAqB,6CAArB;;AAEN,MAAM,UAAU,IAAI,GAAJ,CACZ,qBAAY,iBAAZ,EACK,MADL,CACY;WAAY,SAAS,QAAT,CAAkB,KAAlB;CAAZ,CADZ,CAEK,GAFL,CAES;WAAY,CAAC,SAAS,KAAT,CAAe,CAAf,EAAkB,CAAC,CAAD,CAAnB,EAAwB,sBAAa,CAAC,GAAE,iBAAH,EAAqB,GAAE,QAAvB,EAAgC,CAA7C,EAAgD,QAAhD,EAAxB;CAAZ,CAHG,CAAV;;kBAMS,6BAAc;AACzB,0BAAM,KAAK;AACP,YAAI,MAAJ,CAAW,IAAI,MAAJ,KAAe,MAAf,IAAyB,IAAI,MAAJ,KAAe,KAAf,EAAsB,GAA1D,EADO;AAEP,cAAM,aAAa,IAAI,KAAJ,CAAU,WAAV,CAAsB,GAAtB,CAA0B,YAA1B,CAAb,CAFC;AAGP,YAAI,aAAa,QAAQ,GAAR,CAAY,UAAZ,CAAb,CAHG;AAIP,YAAI,MAAJ,CAAW,UAAX,EAAuB,GAAvB,EAJO;AAKP,YAAI,GAAJ,CAAQ,eAAR,EAAyB,KAAK,WAAL,EAAzB,EALO;;AAOP,YAAI,eAAe,mBAAf,EAAoC;AACpC,yBAAa,WAAW,OAAX,CAAmB,kBAAnB,EAAuC,CAAC,KAAD,GAAQ,IAAI,OAAJ,CAAY,MAAZ,EAAmB,kBAA3B,CAAvC,CAAb,CADoC;SAAxC,MAEO,IAAI,eAAe,gBAAf,EAAiC;AACxC,yBAAa,WAAW,OAAX,CACT,kBADS,EAET,CAAC,iBAAD,GAAoB,IAAI,OAAJ,CAAY,MAAZ,EAAmB,eAAvC,GAAwD,IAAI,GAAJ,CAAQ,MAAR,CAAe,GAAf,CAAmB,WAAnB,EAAgC,GAAhC,CAAoC,MAApC,CAAxD,EAAoG,CAF3F,CAAb,CADwC;SAArC;;AAOP,YAAI,IAAJ,GAAW,UAAX,CAhBO;KADc;CAAd","file":"server/controllers/installScriptsController.js","sourcesContent":["import newController from 'alp-controller';\nimport { readdirSync, readFileSync } from 'fs';\n\nconst installScriptsDir = `${__dirname}/../../../install-scripts/`;\nconst date = new Date();\nconst CONFIG_PLACEHOLDER = '### SERVER CONFIG WILL BE INJECTED HERE ###';\n\nconst scripts = new Map(\n    readdirSync(installScriptsDir)\n        .filter(filename => filename.endsWith('.sh'))\n        .map(filename => [filename.slice(0, -3), readFileSync(`${installScriptsDir}${filename}`).toString()])\n);\n\nexport default newController({\n    index(ctx) {\n        ctx.assert(ctx.method === 'HEAD' || ctx.method === 'GET', 405);\n        const scriptName = ctx.route.namedParams.get('scriptName');\n        let scriptBody = scripts.get(scriptName);\n        ctx.assert(scriptBody, 404);\n        ctx.set('Last-Modified', date.toUTCString());\n\n        if (scriptName === 'install-raspberry') {\n            scriptBody = scriptBody.replace(CONFIG_PLACEHOLDER, `URL=\"${ctx.request.origin}/install-scripts/\"`);\n        } else if (scriptName === 'install-client') {\n            scriptBody = scriptBody.replace(\n                CONFIG_PLACEHOLDER,\n                `SERVER_HOSTNAME=\"${ctx.request.origin}\"\\nSERVER_PORT=${ctx.app.config.get('tcpSocket').get('port')}`\n            );\n        }\n\n        ctx.body = scriptBody;\n    },\n});\n"],"sourceRoot":"/"}