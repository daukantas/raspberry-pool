{"version":3,"sources":["../../../../src/modules/raspberries/actions/raspberry.js"],"names":["changeConfig","sendAction","registerUnknown","updateAll","add","update","raspberry","id","updateConfig","config","remove","screenshotUpdated","saving","saved","changes","sendingAction","action","actionSent","result","newConfig","dispatch","websocket","configSaved","emit","data","raspberries","forEach","map","r","name","addOrReplace","newRaspberry"],"mappings":"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","file":"raspberry.js","sourcesContent":["import { createAction } from 'alp-react-redux';\n\nexport const updateAll = createAction('UPDATE_ALL_RASPBERRIES', 'raspberries');\nexport const add = createAction('ADD_RASPBERRY', 'raspberry');\nexport const update = createAction('UPDATE_RASPBERRY', raspberry => ({ id: raspberry.id, raspberry }));\nexport const updateConfig = createAction(\n    'UPDATE_RASPBERRY_CONFIG',\n    (raspberry, config: Object) => ({ id: raspberry.id, config }),\n);\nexport const remove = createAction('REMOVE_RASPBERRY', 'id');\nexport const screenshotUpdated = createAction('SCREENSHOT_UPDATED', 'id,screenshotDate');\nexport const saving = createAction('SAVING_RASPBERRY', raspberry => ({ id: raspberry.id }));\nexport const saved = createAction('SAVED_RASPBERRY', (raspberry, changes) => ({ id: raspberry.id, changes }));\nexport const sendingAction = createAction(\n    'SENDING_ACTION_RASPBERRY',\n    (raspberry, action) => ({ id: raspberry.id, action })\n);\nexport const actionSent = createAction(\n    'ACTION_SENT_RASPBERRY',\n    (raspberry, action, result) => ({ id: raspberry.id, action, result })\n);\n\nexport function changeConfig(raspberry, newConfig) {\n    return async (dispatch, { websocket }) => {\n        dispatch(saving(raspberry));\n        const configSaved: Object = await websocket.emit('raspberry:changeConfig', raspberry.id, newConfig);\n        dispatch(updateConfig(raspberry, configSaved));\n        dispatch(saved(raspberry, { data: { ...raspberry.data, config: configSaved } }));\n    };\n}\n\nexport function sendAction(raspberries, action) {\n    return async (dispatch, { websocket }) => {\n        raspberries.forEach(raspberry => dispatch(sendingAction(raspberry, action)));\n        const result = await websocket.emit('raspberry:sendAction', raspberries.map(r => r.id), action);\n        raspberries.forEach(raspberry => dispatch(actionSent(raspberry, action, result)));\n    };\n}\n\nexport function registerUnknown(raspberry, { name, addOrReplace, id }) {\n    return async (dispatch, { websocket }) => {\n        dispatch(saving(raspberry));\n        const newRaspberry = await websocket.emit('raspberry:registerUnknown', raspberry.id, { name, addOrReplace, id });\n        if (newRaspberry) {\n            if (newRaspberry.id !== raspberry.id) {\n                dispatch(remove(raspberry.id));\n                dispatch(update(newRaspberry));\n            } else {\n                dispatch(saved(newRaspberry, newRaspberry));\n            }\n        }\n    };\n}\n"]}